import  matplotlib
from 	matplotlib import pyplot as plt
import  tensorflow as tf
from   keras import datasets
import  os
from tensorflow import keras

#tf.gatherå¯ä»¥å®ç°æ ¹æ®ç´¢å¼•å·æ”¶é›†æ•°æ®çš„ç›®çš„
#è€ƒè™‘ç­çº§æˆç»©å†Œçš„ä¾‹å­ï¼Œå…±æœ‰4 ä¸ªç­çº§ï¼Œæ¯ä¸ªç­çº§35 ä¸ªå­¦ç”Ÿï¼Œ8 é—¨ç§‘ç›®ï¼Œä¿å­˜æˆç»©å†Œçš„å¼ é‡shape ä¸º[4,35,8]
x = tf.random.uniform([4,35,8],maxval=100,dtype=tf.int32)
#ç°åœ¨éœ€è¦æ”¶é›†ç¬¬1-2ä¸ªç­çº§çš„æˆç»©å†Œï¼Œå¯ä»¥ç›´æ¥åˆ‡ç‰‡å®ç°
x[:2]
#ä½†æ˜¯å¯¹äºä¸è§„åˆ™çš„ç´¢å¼•æ–¹å¼ï¼Œæ¯”å¦‚ï¼Œéœ€è¦æŠ½æŸ¥æ‰€æœ‰ç­çº§çš„ç¬¬1,4,9,12,13,27 å·åŒå­¦çš„æˆç»©ï¼Œåˆ™åˆ‡ç‰‡æ–¹å¼å®ç°èµ·æ¥éå¸¸éº»çƒ¦ï¼Œè€Œtf.gather åˆ™æ˜¯é’ˆå¯¹äºæ­¤éœ€æ±‚è®¾è®¡çš„ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼š
tf.gather(x,[0,3,8,11,12,26],axis=1)
#å¦‚æœéœ€è¦æ”¶é›†æ‰€æœ‰åŒå­¦çš„ç¬¬3ï¼Œ5 ç­‰ç§‘ç›®çš„æˆç»©ï¼Œåˆ™å¯ä»¥
tf.gather(x,[2,4],axis=2)
#å¦‚æœå¸Œæœ›æŠ½æŸ¥ç¬¬[2,3]ç­çº§çš„ç¬¬[3,4,6,27]å·åŒå­¦çš„ç§‘ç›®æˆç»©ï¼Œåˆ™å¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªtf.gather å®ç°ã€‚é¦–å…ˆæŠ½å‡ºç¬¬[2,3]ç­çº§ï¼š
students=tf.gather(x,[1,2],axis=0)
#å†ä»è¿™2 ä¸ªç­çº§çš„åŒå­¦ä¸­æå–å¯¹åº”å­¦ç”Ÿæˆç»©ï¼š
tf.gather(students,[2,3,5,26],axis=1)
#å¦‚æœå¸Œæœ›æŠ½æŸ¥ç¬¬2 ä¸ªç­çº§çš„ç¬¬2 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®ï¼Œç¬¬3 ä¸ªç­çº§çš„ç¬¬3 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®ï¼Œç¬¬4 ä¸ªç­çº§çš„ç¬¬4 ä¸ªåŒå­¦çš„æ‰€æœ‰ç§‘ç›®
#æ–¹æ³•1ï¼šé€ä¸ªæ‰‹åŠ¨æå–ç„¶ååˆå¹¶
tf.stack([x[1,1],x[2,2],x[3,3]],axis=0)

#tf.gather_nd
#æ–¹æ³•2ï¼šåˆ©ç”¨tf.gather_ndï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šæ¯æ¬¡é‡‡æ ·çš„åæ ‡æ¥å®ç°é‡‡æ ·å¤šä¸ªç‚¹çš„ç›®çš„
tf.gather_nd(x,[[1,1],[2,2],[3,3]])
#ä¸€èˆ¬åœ°ï¼Œåœ¨ä½¿ç”¨tf.gather_nd é‡‡æ ·å¤šä¸ªæ ·æœ¬æ—¶ï¼Œå¦‚æœå¸Œæœ›é‡‡æ ·ç¬¬i å·ç­çº§ï¼Œç¬¬j ä¸ªå­¦ç”Ÿï¼Œç¬¬k é—¨ç§‘ç›®çš„æˆç»©
tf.gather_nd(x,[[1,1,2],[2,2,3],[3,3,4]])

#tf.boolean_mask
#é™¤äº†å¯ä»¥é€šè¿‡ç»™å®šç´¢å¼•å·çš„æ–¹å¼é‡‡æ ·ï¼Œè¿˜å¯ä»¥é€šè¿‡ç»™å®šæ©ç (mask)çš„æ–¹å¼é‡‡æ ·
x = tf.random.uniform([4,35,8],maxval=100,dtype=tf.int32)
#é‡‡æ ·ç¬¬1 å’Œç¬¬4 ä¸ªç­çº§ï¼Œé€šè¿‡tf.boolean_mask(x, mask, axis)å¯ä»¥åœ¨axis è½´ä¸Šæ ¹æ®mask æ–¹æ¡ˆè¿›è¡Œé‡‡æ ·
#æ³¨æ„æ©ç çš„é•¿åº¦å¿…é¡»ä¸å¯¹åº”ç»´åº¦çš„é•¿åº¦ä¸€è‡´
tf.boolean_mask(x,mask=[True, False,False,True],axis=0)
#å¦‚æœå¯¹ 8 é—¨ç§‘ç›®è¿›è¡Œæ©ç é‡‡æ ·
tf.boolean_mask(x,mask=[True,False,False,True,True,False,False,True],axis=2)
"""
è€ƒè™‘ä¸tf.gather_nd ç±»ä¼¼æ–¹å¼çš„å¤šç»´æ©ç é‡‡æ ·æ–¹å¼ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†
ç­çº§æ•°é‡å‡å°‘åˆ°2 ä¸ªï¼Œå­¦ç”Ÿçš„æ•°é‡å‡å°‘åˆ°3 ä¸ªï¼Œå³ä¸€ä¸ªç­çº§åªæœ‰3 ä¸ªå­¦ç”Ÿï¼Œshape ä¸º
[2,3,8]ã€‚å¦‚æœå¸Œæœ›é‡‡æ ·ç¬¬1 ä¸ªç­çº§çš„ç¬¬1-2 å·å­¦ç”Ÿï¼Œç¬¬2 ä¸ªç­çº§çš„ç¬¬2-3 å·å­¦ç”Ÿ
"""
x = tf.random.uniform([2,3,8],maxval=100,dtype=tf.int32)
tf.gather_nd(x,[[0,0],[0,1],[1,1],[1,2]]) # å¤šç»´åæ ‡é‡‡é›†
#å¦‚æœä½¿ç”¨æ©ç 
tf.boolean_mask(x,[[True,True,False],[False,True,True]])

#tf.where
#ä¾‹å­1ï¼š
"""
é€šè¿‡ tf.where(cond, a, b)æ“ä½œå¯ä»¥æ ¹æ®cond æ¡ä»¶çš„çœŸå‡ä»a æˆ–b ä¸­è¯»å–æ•°æ®ï¼Œæ¡ä»¶åˆ¤å®š
è§„åˆ™å¦‚ä¸‹ï¼š
è‹¥ğ‘ğ‘œğ‘›ğ‘‘ğ‘–ä¸ºğ‘‡ğ‘Ÿğ‘¢ğ‘’ï¼Œğ‘œğ‘– = ğ‘ğ‘– 
è‹¥ğ‘ğ‘œğ‘›ğ‘‘ğ‘–ä¸ºğ¹ğ‘ğ‘™ğ‘ ğ‘’ï¼Œğ‘œğ‘– = ğ‘ğ‘–
å…¶ä¸­ i ä¸ºå¼ é‡çš„ç´¢å¼•ï¼Œè¿”å›å¼ é‡å¤§å°ä¸a,b å¼ é‡ä¸€è‡´ï¼Œå½“å¯¹åº”ä½ç½®ä¸­ğ‘ğ‘œğ‘›ğ‘‘ğ‘–ä¸ºTrueï¼Œğ‘œğ‘–ä½ç½®
ä»ğ‘ğ‘–ä¸­å¤åˆ¶æ•°æ®ï¼›å½“å¯¹åº”ä½ç½®ä¸­ğ‘ğ‘œğ‘›ğ‘‘ğ‘–ä¸ºFalseï¼Œğ‘œğ‘–ä½ç½®ä»ğ‘ğ‘–ä¸­å¤åˆ¶æ•°æ®ã€‚è€ƒè™‘ä»2 ä¸ªå…¨1ã€
å…¨0 çš„3x3 å¤§å°çš„å¼ é‡a,b ä¸­æå–æ•°æ®ï¼Œå…¶ä¸­cond ä¸ºTrue çš„ä½ç½®ä»a ä¸­å¯¹åº”ä½ç½®æå–ï¼Œ
cond ä¸ºFalse çš„ä½ç½®ä»b å¯¹åº”ä½ç½®æå–ï¼š
"""
a = tf.ones([3,3]) # æ„é€ a ä¸ºå…¨1
b = tf.zeros([3,3]) # æ„é€ b ä¸ºå…¨0
# æ„é€ é‡‡æ ·æ¡ä»¶
cond = tf.constant([[True,False,False],[False,True,False],[True,True,False]])
tf.where(cond,a,b) # æ ¹æ®æ¡ä»¶ä»a,b ä¸­é‡‡æ ·
#ä¾‹å­2ï¼š
cond = tf.constant([[True,False,False],[False,True,False],[True,True,False]])
#å…¶ä¸­True å…±å‡ºç°4 æ¬¡ï¼Œæ¯ä¸ªTrue ä½ç½®å¤„çš„ç´¢å¼•åˆ†å¸ƒä¸º[0,0], [1,1], [2,0], [2,1]ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡tf.where(cond)æ¥è·å¾—è¿™äº›ç´¢å¼•åæ ‡
tf.where(cond)
#ç”¨é€”ï¼š
#æˆ‘ä»¬éœ€è¦æå–å¼ é‡ä¸­æ‰€æœ‰æ­£æ•°çš„æ•°æ®å’Œç´¢å¼•ã€‚é¦–å…ˆæ„é€ å¼ é‡a
x = tf.random.normal([3,3])
#é€šè¿‡æ¯”è¾ƒè¿ç®—ï¼Œå¾—åˆ°æ­£æ•°çš„æ©ç 
mask=x>0 # æ¯”è¾ƒæ“ä½œï¼Œç­‰åŒäºtf.equal()
#é€šè¿‡tf.where æå–æ­¤æ©ç å¤„True å…ƒç´ çš„ç´¢å¼•
indices=tf.where(mask) # æå–æ‰€æœ‰å¤§äº0 çš„å…ƒç´ ç´¢å¼•
#æ‹¿åˆ°ç´¢å¼•åï¼Œé€šè¿‡tf.gather_nd å³å¯æ¢å¤å‡ºæ‰€æœ‰æ­£æ•°çš„å…ƒç´ 
tf.gather_nd(x,indices) # æå–æ­£æ•°çš„å…ƒç´ å€¼
#å½“æˆ‘ä»¬å¾—åˆ°æ©ç mask ä¹‹åï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡tf.boolean_mask è·å–å¯¹åº”å…ƒç´ 
tf.boolean_mask(x,mask) # é€šè¿‡æ©ç æå–æ­£æ•°çš„å…ƒç´ å€¼

#scatter_nd








